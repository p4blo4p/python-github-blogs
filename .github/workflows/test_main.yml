name: Execute Single Blog (Auto Hourly + Manual)

on:
  # 1. Trigger Automático: Se ejecuta cada hora en punto (minuto 0)
  schedule:
    - cron: '0 * * * *'

  # 2. Trigger Manual: Permite ejecutar el workflow desde la pestaña 'Actions' de GitHub
  # Al no tener 'inputs:', se ejecuta directamente con los valores fijos del script.
  workflow_dispatch:

  push:
    branches:
      - main  # Asegúrate de que tu rama principal sea 'main'. Si es 'master', cámbialo aquí.

permissions:
  contents: write  # Necesario para crear archivos en el repositorio

jobs:
  execute:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Execute Blog
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          # Se ejecutará tanto en el horario programado como cuando pulses manualmente
          #python main.py --fetch --blog "Crypto Daily"
          python main.py --all --blog "Crypto Daily"